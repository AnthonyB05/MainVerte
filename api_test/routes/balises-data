const express = require('express');
const router = express.Router();
const baliseJson = require('../../balises-data.json');
const baliseData = require('../model/balise-data');
const mongoose = require('mongoose');
router.get('/', (req,res,next) => {  
    baliseData.find().sort({date:-1})
    .then(result=>{
       res.status(200).json({
           balisesData:result
       }

       )
    })})

router.post('/',(req,res,next)=>{
    const uneBaliseData = new baliseData({
        idBalise: req.body.idBalise,
        degreCelsius:req.body.degreCelsius,
        humiditeExt: req.body.humiditeExt,
        luminosite: req.body.luminosite,
        longitude: req.body.longitude,
        latitude: req.body.latitude,
       
    })
    uneBaliseData.save()
   .then(result=>{
    console.log(result);
    res.status(200).json({
        newBalise:result
    })
   })
   .catch(err=>{
    console.log(err);
    res.status(500).json({
        error:err
    });
   })
 })

 router.get('/:id',(req,res,next) => { 
    console.log(req.params.id)
    baliseData.find({idBalise: req.params.id}).sort({date: -1})
    .then(result=>{
        res.status(200).json({
            balisesData:result
        })
    })
    .catch(err=>{
        console.log(err);
        res.status(500).json({
            error:err
        })
    })
})
router.get('/:id/last',(req,res,next) => { 
    console.log(req.params.id)
    baliseData.findOne({idBalise: req.params.id}).sort({date: -1})
    .then(result=>{
        res.status(200).json({
            balisesData:result
        })
    })
    .catch(err=>{
        console.log(err);
        res.status(500).json({
            error:err
        })
    })
})
module.exports = router;